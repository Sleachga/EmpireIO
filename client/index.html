<!-- TODO:

Canvas onLeftClick highlights a region and commands
all units in that area.  Add a goto point function

Canvas onRightClick makes a menu similar to paragon,
highlights the button its over and gives you the
option to create units

Add mini map, maybe make it a popup menu when you
hold down q

https://www.kirupa.com/html5/getting_mouse_click_position.htm

When you move multiple units to one spot put them randomly in a circle
with a certain radius around the point clicked

EX:

             point ~~~>     *

                           ___
                         /     \
    finishing area ~~~>  |  *  |
                         \_____/
-->

<html>
  <head>
    <title>Empire IO</title>
    <link rel="icon" href="client/img/favicon.ico"/>
    <link rel="stylesheet" href="client/index.css"/>
  </head>

  <body>

    <div id="canvasContainer">
      <canvas id="ctx" width="500" height="500"></canvas>
    </div>

    </br>

    <button id="mapRandButton">Randomize Map</button>

    <script src="https://cdn.socket.io/socket.io-1.4.5.js"></script>
    <script src="client/img/images.js"></script>


    <script>

        document.body.addEventListener('wheel', function(e){ e.preventDefault(); });

        // Creates an object for the canvas
        var ctx = document.getElementById("ctx").getContext("2d");

        ctx.canvas.width = window.innerWidth - 20;
        ctx.canvas.height = window.innerHeight - 20;
        ctx.font = '30px Arial';

        var gameX = 0;
        var gameY = 0;

        var mouseX = 0;
        var mouseY = 0;
        var mouseDown = false;
        var mouseClickPos =
        {
          x: 0,
          y: 0
        }

        var clickOffsetX = 0;
        var clickOffsetY = 0;

        var unitList;

        var WIDTH = window.innerWidth;
        var HEIGHT = window.innerHeight;
        var screenX = 0;
        var screenY = 0;
        var cameraSpeed = 3;
        var angle = 0;
        var keys =
        {
          up: false,
          down: false,
          left: false,
          right: false
        };

        document.onkeydown = function(event)
        {
            if(event.keyCode === 68) //d
              keys.right = true;
            else if(event.keyCode === 65) //a
              keys.left = true;
            else if(event.keyCode === 83) //s
              keys.down = true;
            else if(event.keyCode === 87) //w
              keys.up = true;
        };

        document.onkeyup = function(event)
        {
            if(event.keyCode === 68) //d
              keys.right = false;
            else if(event.keyCode === 65) //a
              keys.left = false;
            else if(event.keyCode === 83) //s
              keys.down = false;
            else if(event.keyCode === 87) //w
              keys.up = false;
        };

        document.onmousemove = function(event)
        {
          // Set global mouseX and mouseY variables
          mouseX = event.clientX;
          mouseY = event.clientY;
          var x = -WIDTH/2 + event.clientX;
          var y = -HEIGHT/2 + event.clientY;
        }

        // Keeps the right click from popping a menu up
        document.oncontextmenu = function(event)
        {
          var evt = new Object({keyCode:93});

          if(event.preventDefault != undefined)
            event.preventDefault();

          if(event.stopPropagation != undefined)
            event.stopPropagation();
        }

        document.onmousedown = function(event)
        {
          var button = event.button;

          if (button === 2)
            console.log("Mouse Click -> " + button);
          else if (button === 0)
            console.log("Mouse Click -> " + button);

          mouseDown = true;
          mouseClickPos.x = event.clientX;
          mouseClickPos.y = event.clientY;

          console.log("Click -> X: " + mouseClickPos.x
            + " Y: " + mouseClickPos.y);
        }

        document.onmouseup = function(event)
        {
          mouseDown = false;
          clickOffsetX = 0;
          clickOffsetY = 0;
        }

        // Creates an object for the randomize map button
        var mapRand = document.getElementById('mapRandButton');

        // Calls a function to reset the map grid on button click
        mapRand.onclick = function()
        {
          socket.emit('mapRand');
        }

        // Creates the socket.io object
        var socket = io();

        // Creates and sets the default for the map matrix
        var mapMatrix = [
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // 1
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // 2
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // 3
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // 4
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // 5
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // 6
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // 7
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // 8
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10], // 9
            [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  // 10
        ];

        // Initially sets the map grid
        socket.on('mapInit', function(data)
        {
            var mapGrid = data;

            // Convert into multi-demensional array
            var counter = 0;

            for (var i = 0; i < 10; i++)
            {
              for (var j = 0; j < 10; j++)
              {
                console.log(mapGrid[counter]);
                mapMatrix[i][j] = mapGrid[counter++];
              }
            }
        });

        var unitListPosted = false;

        // Sets the map grid on update (25 times a second)
        socket.on('update', function(data)
        {
          unitList = data;
      });

      /*
        Essentially the main loop, game logic and canvas drawing
        Goes on here
      */
      setInterval(function()
      {
        if (keys.right)
        {
          screenX -= cameraSpeed;
          if (mouseDown) clickOffsetX += cameraSpeed;
        }
        if (keys.left)
        {
          screenX += cameraSpeed;
          if (mouseDown) clickOffsetX -= cameraSpeed;
        }
        if (keys.up)
        {
          screenY += cameraSpeed;
          if (mouseDown) clickOffsetY -= cameraSpeed;
        }
        if (keys.down)
        {
          screenY -= cameraSpeed;
          if (mouseDown) clickOffsetY += cameraSpeed;
        }

        ctx.clearRect(0,0, ctx.canvas.width, ctx.canvas.height);

        // Reads the Map Matrix and colors the tiles accordingly
        for (var i = 0; i < 10; i++)
        {
          for (var j = 0; j < 10; j++)
          {
            var fillType = mapMatrix[i][j].type;
            var xOffset = screenX + (100 * j);
            var yOffset = screenY + (100 * i);

            switch (fillType)
            {
              case 1:
                ctx.drawImage(Img.foodTile1, xOffset, yOffset);
                break;

              case 2:
                ctx.drawImage(Img.stoneTile1, xOffset, yOffset);
                break;

              case 3:
                ctx.drawImage(Img.forestTile1, xOffset, yOffset);
                break;

              case 4:
                ctx.drawImage(Img.goldTile1, xOffset, yOffset);
                break;

              default:
                ctx.fillStyle = 'white';
                ctx.fillRect(xOffset, yOffset, 100, 100);
            }
          }
        }
        // TODO Function to check where the mouse is (highlight tile)

        // Set and draw units

        if (unitList)
        {
          for (var i = 0; i < unitList.length; i++)
          {
            var unit = unitList[i];
            ctx.drawImage(Img.unit, screenX + unit.x, screenY + unit.y);
          }
        }

        ctx.fillStyle = "black";

        // Draw the highlighting rectangle
        gameX = mouseX + (-1 * screenX);
        gameY = mouseY + (-1 * screenY);

        if (mouseDown)
        {
          var width = mouseX - mouseClickPos.x;
          var height = mouseY - mouseClickPos.y;

          ctx.fillStyle = 'red';
          ctx.globalAlpha = 0.2;
          ctx.fillRect(mouseClickPos.x - clickOffsetX,
            mouseClickPos.y - clickOffsetY, width + clickOffsetX,
            height + clickOffsetY);
          ctx.globalAlpha = 1;
        }

        // Draw mouse cursor
        ctx.drawImage(Img.cursor, mouseX, mouseY);

        drawScore();

      }, 40);

      var drawScore = function()
      {
          ctx.fillStyle = 'black';
          ctx.globalAlpha = 0.5;
          ctx.fillRect(0, 0, WIDTH, 40);
          ctx.globalAlpha = 1;
          ctx.fillStyle = 'white';
          ctx.font = "30px Verdana";
          ctx.fillText("X: " + mouseX + " Y: "
              + mouseY + " clickOffsetX: " + clickOffsetX
              + " clickOffsetY: " + clickOffsetY
              + " click: " + mouseDown, WIDTH/2 - 400, 30);
      }

    </script>

    <p></p>

    </body>
</html>
